# 迁移-咪咕中台

## 目标

party\-game项目中，有一个中台系统，是自研，分析下，是否能迁移过来，并搭建起来，实现复用

## 产品文档PRD：

https://kxleqzb9u6.feishu.cn/docs/doccnwSzzLFTgf6ikk9Z3Pa0vbg

## 梳理项目

项目整体上分成两个部分

1. 游戏：UNITY前端\+UNITY后端
2. 中台系统

unity端基本上代码没有碰，无法迁移，所以 ，重点是第2条：中台

中台，先从从GIT项目仓看，如下几个：

1. 匹配
    http://192.168.1.22:40080/service/partygame/gamematch
2. 后台管理\-后端
    http://192.168.1.22:40080/service/partygame/adminserver.git
3. 后台管理\-前端
    http://192.168.1.22:40080/service/partygame/adminweb.git
4. 基础服务中心，如：用户中心、任务、成就、站内信等，都是短连接
    http://192.168.1.22:40080/service/partygame/accountserver.git
5. 房间服务/消息中心，接收UNITY后端发送的mqtt消息，创建房间，与匹配服务进行通信
    http://192.168.1.22:40080/service/partygame/msgServer.git

> 其中2和3，是可以合成一个项目的，所以，最大的方向看，一共是4个微服务

中台，从功能模块上看，大体分成如下几块：

1. Room：房间服务/大厅服务，长连接\(与unity后端通信\)，使用的mqtt协议及管理软件，主要功能：组队、mqtt长连接、IM消息收发
2. 匹配：对玩家进行分组匹配，主要与room通信
3. 帧同步：长连接，对玩家在一局游戏的动作、释放技能等同步，（简单的囚徒锁模式）
4. 管理后台：管理整个游戏的：配置信息、用户信息、黑词、举报、认识、基础统计、订单统计等，辅助完成日常运营 。node \+ vue \+ go
5. 用户中心：注册/登陆/、任务、邮件\(站内信\)、道具、成就、好友、粉丝、订单、支付、货币消耗、存档、站内信等

结合看，以上就是需要迁移的所有模块\(代码\)

用到的语言：GO\+VUE

用到的开源软件：emqtt\+redis\+mysql\+etcd

## 咪咕

测试环境\-IP

> 114.116.212.202

admin URL

> http://114.116.212.202/admin/ui/\#/login

swag:

> http://114.116.212.202/account/dev/swagger/index.html\#/%E7%B3%BB%E7%BB%9F/post\_v1\_sys\_addJewel

项目提交测试：

```
scp -r adminserver  root@114.116.212.202:/www/git_project
scp -r  accountserver  root@114.116.212.202:/www/git_project
go build -o accountServer
```

## 迁移流程

1. github上创建版本库，并将代码上传至新的版本库中
2. 本地安装与测试
    1. 将原代码clone后，转至新的库中，并提交
    2. 依赖软件\(开源\)安装: MYSQL REDIS E\-MQTT GO NODE NPM ETCD
    3. 创建数据库、表，并初始化基数据
    4. 初始化etcd基数据
    5. 启动运行程度，调试代码
    6. 日志存储目录配置、配置文件创建并修改
    7. 记录调试过程
3. 测试环境搭建
    1. 确定服务器
    2. 确定域名
    3. 重复步骤2

## gitlab创建过程

在gitlab上创建好组，将几个项目统一放置于一个目录下

# 开始迁移

## 匹配服务

Git url:

> http://192.168.1.22:40080/service/partygame/gamematch

脚本启动指令：

> go run main.go dev /data/www/golang/src/service/partygame/logs 1023 http://127.0.0.1/etcd\_info.php

> go run main.go dev /Users/mayanyan/data/www/golang/logs 1023 http://127.0.0.1/1

参数说明：

1. 环境变量：Local dev test online
2. 日志存储目录
3. 日志级别：1 2 4 .....全部是 1023
4. 获取ETCD连接信息

先创建好日志存储目录，注：这里的目录下还需要再创建子目录:service

mkdir \-p /data/www/golang/src/service/partygame/logs/service

chmod \-R 777 /data/www/golang/src/service/partygame/logs

依赖组件：ETCD REDIS

依赖3方服务：获取\(动态\)ETCD连接地址，匹配成功推送数据

依赖配置：

1. ETCD地址，是动态获取，启动脚本的时候需要把URL地址一并写入，其返回格式如下：
    {"code":0,"data":{"username":"","password":"","hosts":\["8.142.177.235:2379"\]}}
2. ETCD里，有REDIS 的配置信息，需要提前打入
    etcdctl \-\-endpoints=127.0.0.1:2379 put /gamematch/dev/pid\_file\_path /tmp/gamematch.pid
    etcdctl \-\-endpoints=127.0.0.1:2379 put /gamematch/dev/redis\_host 8.142.177.235
    etcdctl \-\-endpoints=127.0.0.1:2379 put /gamematch/dev/redis\_port 6379
    etcdctl \-\-endpoints=8.142.177.235:2379 put /gamematch/dev/redis\_ps 1234
    etcdctl \-\-endpoints=127.0.0.1:2379 put /gamematch/dev/reg\_self\_port 5678
3. ETCD里，有后台配置好的的：匹配规则基础配置信息，需要提前打入
    etcdctl \-\-endpoints=8.142.177.235:2379 put /v1/conf/matches/test\_match\_group '{"id":6,"games\_id":68043879,"name":"1v1v1","status":1,"match\_code":"test\_match\_group","team\_type":1,"max\_players":6,"rule":"{}","rule\_ver":1,"timeout":10,"success\_timeout":20}'

etcdctl \-\-endpoints=8.142.177.235:2379 get / \-\-prefix

服务注册etcd，KEY：

/v1/service/gamematch/192.168.1.169:6789

调用3方服务etcd,key:

/v1/service/msgServer/192.168.1.169:8080

## 管理后台\-后端

> git clone http://192.168.1.22:40080/service/partygame/adminserver.git

依赖组件：ETCD REDIS MYSQL EMAIL aliyun

先导入DB，两个库 pg\_account pg\_friend

CREATE DATABASE IF NOT EXISTS pg\_account DEFAULT CHARSET utf8 COLLATE utf8\_general\_ci;

use pg\_account

source /install/pg\_account.sql

source /install/pg\_account\_data.sql

处理下视图

```
SELECT TABLE_SCHEMA, TABLE_NAME FROM information_schema.tables WHERE TABLE_TYPE LIKE 'VIEW';
authority_menu;
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `authority_menu`  AS SELECT `sys_base_menus`.`id` AS `id`, `sys_base_menus`.`created_at` AS `created_at`, `sys_base_menus`.`updated_at` AS `updated_at`, `sys_base_menus`.`deleted_at` AS `deleted_at`, `sys_base_menus`.`menu_level` AS `menu_level`, `sys_base_menus`.`parent_id` AS `parent_id`, `sys_base_menus`.`path` AS `path`, `sys_base_menus`.`name` AS `name`, `sys_base_menus`.`hidden` AS `hidden`, `sys_base_menus`.`component` AS `component`, `sys_base_menus`.`title` AS `title`, `sys_base_menus`.`icon` AS `icon`, `sys_base_menus`.`sort` AS `sort`, `sys_authority_menus`.`sys_authority_authority_id` AS `authority_id`, `sys_authority_menus`.`sys_base_menu_id` AS `menu_id`, `sys_base_menus`.`keep_alive` AS `keep_alive`, `sys_base_menus`.`default_menu` AS `default_menu` FROM (`sys_authority_menus` join `sys_base_menus` on((`sys_authority_menus`.`sys_base_menu_id` = `sys_base_menus`.`id`))) ;
```

CREATE DATABASE IF NOT EXISTS pg\_friend DEFAULT CHARSET utf8 COLLATE utf8\_general\_ci;

use pg\_friend

source /install/pg\_friend.sql

```
cp config.toml.demo config.toml
vim config.toml
```

go run main.go

## 管理后台\-前端

> git clone http://192.168.1.22:40080/service/partygame/adminweb.git

centos:yum install xdg\-utils

//开始安装NODE依赖包\(最好是挂VPN\)

npm install \-\-unsafe\-perm=true \-\-allow\-root

启动

npm run serve

http://127.0.0.1:8080

上面是测试，上到正式环境，是将前端js打包，放到GO的项目里，统一一个项目就OK了

npm run build

cp \-r dist adminserver/resource

## account

> git clone http://192.168.1.22:40080/service/partygame/accountserver.git
> 
> 
> cp config.simple.toml config.toml

~/go/bin/swag init

go run main.go

## msgServer

> git clone http://192.168.1.22:40080/service/partygame/msgServer.git
> 
> 
> cp config.simple.toml config.toml

依赖 e

重连检测\-玩家离线后重新获取组队信息或重新进入组队

/battle/v1/group/reconnect/63030530

查询我所在的最新队伍信息

GET /battle/v1/group/info/63030530 HTTP/1.1

%E7%9B%AE%E6%A0%87%0A\-\-\-\-%0Aparty\-game%E9%A1%B9%E7%9B%AE%E4%B8%AD%EF%BC%8C%E6%9C%89%E4%B8%80%E4%B8%AA%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F%EF%BC%8C%E6%98%AF%E8%87%AA%E7%A0%94%EF%BC%8C%E5%88%86%E6%9E%90%E4%B8%8B%EF%BC%8C%E6%98%AF%E5%90%A6%E8%83%BD%E8%BF%81%E7%A7%BB%E8%BF%87%E6%9D%A5%EF%BC%8C%E5%B9%B6%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%A4%8D%E7%94%A8%0A%0A%E4%BA%A7%E5%93%81%E6%96%87%E6%A1%A3PRD%EF%BC%9A%0A\-\-\-%0Ahttps%3A%2F%2Fkxleqzb9u6.feishu.cn%2Fdocs%2FdoccnwSzzLFTgf6ikk9Z3Pa0vbg%0A%0A%E6%A2%B3%E7%90%86%E9%A1%B9%E7%9B%AE%0A\-\-\-\-\-%0A%0A%E9%A1%B9%E7%9B%AE%E6%95%B4%E4%BD%93%E4%B8%8A%E5%88%86%E6%88%90%E4%B8%A4%E4%B8%AA%E9%83%A8%E5%88%86%0A1.%20%E6%B8%B8%E6%88%8F%EF%BC%9AUNITY%E5%89%8D%E7%AB%AF%2BUNITY%E5%90%8E%E7%AB%AF%0A2.%20%E4%B8%AD%E5%8F%B0%E7%B3%BB%E7%BB%9F%0A%0Aunity%E7%AB%AF%E5%9F%BA%E6%9C%AC%E4%B8%8A%E4%BB%A3%E7%A0%81%E6%B2%A1%E6%9C%89%E7%A2%B0%EF%BC%8C%E6%97%A0%E6%B3%95%E8%BF%81%E7%A7%BB%EF%BC%8C%E6%89%80%E4%BB%A5%20%EF%BC%8C%E9%87%8D%E7%82%B9%E6%98%AF%E7%AC%AC2%E6%9D%A1%EF%BC%9A%E4%B8%AD%E5%8F%B0%0A%0A%E4%B8%AD%E5%8F%B0%EF%BC%8C%E5%85%88%E4%BB%8E%E4%BB%8EGIT%E9%A1%B9%E7%9B%AE%E4%BB%93%E7%9C%8B%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%87%A0%E4%B8%AA%EF%BC%9A%0A1.%20%E5%8C%B9%E9%85%8D%0Ahttp%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2Fgamematch%0A2.%20%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86\-%E5%90%8E%E7%AB%AF%0Ahttp%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2Fadminserver.git%0A3.%20%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86\-%E5%89%8D%E7%AB%AF%0Ahttp%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2Fadminweb.git%0A4.%20%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E4%B8%AD%E5%BF%83%EF%BC%8C%E5%A6%82%EF%BC%9A%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83%E3%80%81%E4%BB%BB%E5%8A%A1%E3%80%81%E6%88%90%E5%B0%B1%E3%80%81%E7%AB%99%E5%86%85%E4%BF%A1%E7%AD%89%EF%BC%8C%E9%83%BD%E6%98%AF%E7%9F%AD%E8%BF%9E%E6%8E%A5%0Ahttp%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2Faccountserver.git%0A5.%20%E6%88%BF%E9%97%B4%E6%9C%8D%E5%8A%A1%2F%E6%B6%88%E6%81%AF%E4%B8%AD%E5%BF%83%EF%BC%8C%E6%8E%A5%E6%94%B6UNITY%E5%90%8E%E7%AB%AF%E5%8F%91%E9%80%81%E7%9A%84mqtt%E6%B6%88%E6%81%AF%EF%BC%8C%E5%88%9B%E5%BB%BA%E6%88%BF%E9%97%B4%EF%BC%8C%E4%B8%8E%E5%8C%B9%E9%85%8D%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1%0Ahttp%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2FmsgServer.git%0A%0A%3E%E5%85%B6%E4%B8%AD2%E5%92%8C3%EF%BC%8C%E6%98%AF%E5%8F%AF%E4%BB%A5%E5%90%88%E6%88%90%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%EF%BC%8C%E6%9C%80%E5%A4%A7%E7%9A%84%E6%96%B9%E5%90%91%E7%9C%8B%EF%BC%8C%E4%B8%80%E5%85%B1%E6%98%AF4%E4%B8%AA%E5%BE%AE%E6%9C%8D%E5%8A%A1%0A%0A%E4%B8%AD%E5%8F%B0%EF%BC%8C%E4%BB%8E%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E4%B8%8A%E7%9C%8B%EF%BC%8C%E5%A4%A7%E4%BD%93%E5%88%86%E6%88%90%E5%A6%82%E4%B8%8B%E5%87%A0%E5%9D%97%EF%BC%9A%0A1.%20Room%EF%BC%9A%E6%88%BF%E9%97%B4%E6%9C%8D%E5%8A%A1%2F%E5%A4%A7%E5%8E%85%E6%9C%8D%E5%8A%A1%EF%BC%8C%E9%95%BF%E8%BF%9E%E6%8E%A5\(%E4%B8%8Eunity%E5%90%8E%E7%AB%AF%E9%80%9A%E4%BF%A1\)%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%9A%84mqtt%E5%8D%8F%E8%AE%AE%E5%8F%8A%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%EF%BC%9A%E7%BB%84%E9%98%9F%E3%80%81mqtt%E9%95%BF%E8%BF%9E%E6%8E%A5%E3%80%81IM%E6%B6%88%E6%81%AF%E6%94%B6%E5%8F%91%0A2.%20%E5%8C%B9%E9%85%8D%EF%BC%9A%E5%AF%B9%E7%8E%A9%E5%AE%B6%E8%BF%9B%E8%A1%8C%E5%88%86%E7%BB%84%E5%8C%B9%E9%85%8D%EF%BC%8C%E4%B8%BB%E8%A6%81%E4%B8%8Eroom%E9%80%9A%E4%BF%A1%0A3.%20%E5%B8%A7%E5%90%8C%E6%AD%A5%EF%BC%9A%E9%95%BF%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%AF%B9%E7%8E%A9%E5%AE%B6%E5%9C%A8%E4%B8%80%E5%B1%80%E6%B8%B8%E6%88%8F%E7%9A%84%E5%8A%A8%E4%BD%9C%E3%80%81%E9%87%8A%E6%94%BE%E6%8A%80%E8%83%BD%E7%AD%89%E5%90%8C%E6%AD%A5%EF%BC%8C%EF%BC%88%E7%AE%80%E5%8D%95%E7%9A%84%E5%9B%9A%E5%BE%92%E9%94%81%E6%A8%A1%E5%BC%8F%EF%BC%89%0A4.%20%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%EF%BC%9A%E7%AE%A1%E7%90%86%E6%95%B4%E4%B8%AA%E6%B8%B8%E6%88%8F%E7%9A%84%EF%BC%9A%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E3%80%81%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E3%80%81%E9%BB%91%E8%AF%8D%E3%80%81%E4%B8%BE%E6%8A%A5%E3%80%81%E8%AE%A4%E8%AF%86%E3%80%81%E5%9F%BA%E7%A1%80%E7%BB%9F%E8%AE%A1%E3%80%81%E8%AE%A2%E5%8D%95%E7%BB%9F%E8%AE%A1%E7%AD%89%EF%BC%8C%E8%BE%85%E5%8A%A9%E5%AE%8C%E6%88%90%E6%97%A5%E5%B8%B8%E8%BF%90%E8%90%A5%20%E3%80%82node%20%2B%20vue%20%2B%20go%0A5.%20%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83%EF%BC%9A%E6%B3%A8%E5%86%8C%2F%E7%99%BB%E9%99%86%2F%E3%80%81%E4%BB%BB%E5%8A%A1%E3%80%81%E9%82%AE%E4%BB%B6\(%E7%AB%99%E5%86%85%E4%BF%A1\)%E3%80%81%E9%81%93%E5%85%B7%E3%80%81%E6%88%90%E5%B0%B1%E3%80%81%E5%A5%BD%E5%8F%8B%E3%80%81%E7%B2%89%E4%B8%9D%E3%80%81%E8%AE%A2%E5%8D%95%E3%80%81%E6%94%AF%E4%BB%98%E3%80%81%E8%B4%A7%E5%B8%81%E6%B6%88%E8%80%97%E3%80%81%E5%AD%98%E6%A1%A3%E3%80%81%E7%AB%99%E5%86%85%E4%BF%A1%E7%AD%89%0A%0A%E7%BB%93%E5%90%88%E7%9C%8B%EF%BC%8C%E4%BB%A5%E4%B8%8A%E5%B0%B1%E6%98%AF%E9%9C%80%E8%A6%81%E8%BF%81%E7%A7%BB%E7%9A%84%E6%89%80%E6%9C%89%E6%A8%A1%E5%9D%97\(%E4%BB%A3%E7%A0%81\)%0A%0A%E7%94%A8%E5%88%B0%E7%9A%84%E8%AF%AD%E8%A8%80%EF%BC%9AGO%2BVUE%0A%E7%94%A8%E5%88%B0%E7%9A%84%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%EF%BC%9Aemqtt%2Bredis%2Bmysql%2Betcd%0A%0A%0A%0A%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%0A\-\-%0A%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83\-IP%0A%3E114.116.212.202%0A%0Aadmin%20URL%0A%3Ehttp%3A%2F%2F114.116.212.202%2Fadmin%2Fui%2F%23%2Flogin%0A%0Aswag%3A%0A%3Ehttp%3A%2F%2F114.116.212.202%2Faccount%2Fdev%2Fswagger%2Findex.html%23%2F%25E7%25B3%25BB%25E7%25BB%259F%2Fpost\_v1\_sys\_addJewel%0A%0A%0A%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BA%A4%E6%B5%8B%E8%AF%95%EF%BC%9A%0A%60%60%60%0Ascp%20\-r%20adminserver%20%20root%40114.116.212.202%3A%2Fwww%2Fgit\_project%0Ascp%20\-r%20%20accountserver%20%20root%40114.116.212.202%3A%2Fwww%2Fgit\_project%0Ago%20build%20\-o%20accountServer%0A%60%60%60%0A%0A%0A%0A%E8%BF%81%E7%A7%BB%E6%B5%81%E7%A8%8B%0A\-\-\-\-\-%0A1.%20github%E4%B8%8A%E5%88%9B%E5%BB%BA%E7%89%88%E6%9C%AC%E5%BA%93%EF%BC%8C%E5%B9%B6%E5%B0%86%E4%BB%A3%E7%A0%81%E4%B8%8A%E4%BC%A0%E8%87%B3%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC%E5%BA%93%E4%B8%AD%0A2.%20%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85%E4%B8%8E%E6%B5%8B%E8%AF%95%0A%20%20%20%201.%20%E5%B0%86%E5%8E%9F%E4%BB%A3%E7%A0%81clone%E5%90%8E%EF%BC%8C%E8%BD%AC%E8%87%B3%E6%96%B0%E7%9A%84%E5%BA%93%E4%B8%AD%EF%BC%8C%E5%B9%B6%E6%8F%90%E4%BA%A4%0A%20%20%20%202.%20%E4%BE%9D%E8%B5%96%E8%BD%AF%E4%BB%B6\(%E5%BC%80%E6%BA%90\)%E5%AE%89%E8%A3%85%3A%20MYSQL%20REDIS%20E\-MQTT%20GO%20NODE%20NPM%20ETCD%0A%20%20%20%203.%20%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81%E8%A1%A8%EF%BC%8C%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E5%9F%BA%E6%95%B0%E6%8D%AE%0A%20%20%20%204.%20%E5%88%9D%E5%A7%8B%E5%8C%96etcd%E5%9F%BA%E6%95%B0%E6%8D%AE%0A%20%20%20%205.%20%E5%90%AF%E5%8A%A8%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%A6%EF%BC%8C%E8%B0%83%E8%AF%95%E4%BB%A3%E7%A0%81%0A%20%20%20%206.%20%E6%97%A5%E5%BF%97%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95%E9%85%8D%E7%BD%AE%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BF%AE%E6%94%B9%0A%20%20%20%206.%20%E8%AE%B0%E5%BD%95%E8%B0%83%E8%AF%95%E8%BF%87%E7%A8%8B%0A%0A5.%20%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%0A%20%20%20%201.%20%E7%A1%AE%E5%AE%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%0A%20%20%20%202.%20%E7%A1%AE%E5%AE%9A%E5%9F%9F%E5%90%8D%0A%20%20%20%203.%20%E9%87%8D%E5%A4%8D%E6%AD%A5%E9%AA%A42%0A%0A%0Agitlab%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B%0A\-\-\-\-\-%0A%E5%9C%A8gitlab%E4%B8%8A%E5%88%9B%E5%BB%BA%E5%A5%BD%E7%BB%84%EF%BC%8C%E5%B0%86%E5%87%A0%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%BB%9F%E4%B8%80%E6%94%BE%E7%BD%AE%E4%BA%8E%E4%B8%80%E4%B8%AA%E7%9B%AE%E5%BD%95%E4%B8%8B%0A%0A%0A%E5%BC%80%E5%A7%8B%E8%BF%81%E7%A7%BB%0A%3D%3D%3D%3D%0A%0A%E5%8C%B9%E9%85%8D%E6%9C%8D%E5%8A%A1%0A\-\-\-\-\-%0AGit%20url%3A%0A%3Ehttp%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2Fgamematch%0A%0A%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8%E6%8C%87%E4%BB%A4%EF%BC%9A%0A%3Ego%20run%20main.go%20dev%20%2Fdata%2Fwww%2Fgolang%2Fsrc%2Fservice%2Fpartygame%2Flogs%20%201023%20http%3A%2F%2F127.0.0.1%2Fetcd\_info.php%0A%0A%3Ego%20run%20main.go%20dev%20%2FUsers%2Fmayanyan%2Fdata%2Fwww%2Fgolang%2Flogs%20%201023%20http%3A%2F%2F127.0.0.1%2F1%0A%0A%0A%0A%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E%EF%BC%9A%0A1.%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%9ALocal%20dev%20test%20online%20%0A2.%20%E6%97%A5%E5%BF%97%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95%0A3.%20%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB%EF%BC%9A1%202%204%20.....%E5%85%A8%E9%83%A8%E6%98%AF%201023%0A4.%20%E8%8E%B7%E5%8F%96ETCD%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF%0A%0A%E5%85%88%E5%88%9B%E5%BB%BA%E5%A5%BD%E6%97%A5%E5%BF%97%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%B3%A8%EF%BC%9A%E8%BF%99%E9%87%8C%E7%9A%84%E7%9B%AE%E5%BD%95%E4%B8%8B%E8%BF%98%E9%9C%80%E8%A6%81%E5%86%8D%E5%88%9B%E5%BB%BA%E5%AD%90%E7%9B%AE%E5%BD%95%3Aservice%0Amkdir%20\-p%20%2Fdata%2Fwww%2Fgolang%2Fsrc%2Fservice%2Fpartygame%2Flogs%2Fservice%0Achmod%20\-R%20777%20%2Fdata%2Fwww%2Fgolang%2Fsrc%2Fservice%2Fpartygame%2Flogs%0A%0A%E4%BE%9D%E8%B5%96%E7%BB%84%E4%BB%B6%EF%BC%9AETCD%20REDIS%0A%E4%BE%9D%E8%B5%963%E6%96%B9%E6%9C%8D%E5%8A%A1%EF%BC%9A%E8%8E%B7%E5%8F%96\(%E5%8A%A8%E6%80%81\)ETCD%E8%BF%9E%E6%8E%A5%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%8C%B9%E9%85%8D%E6%88%90%E5%8A%9F%E6%8E%A8%E9%80%81%E6%95%B0%E6%8D%AE%0A%0A%E4%BE%9D%E8%B5%96%E9%85%8D%E7%BD%AE%EF%BC%9A%0A1.%20ETCD%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%98%AF%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96%EF%BC%8C%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E7%9A%84%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E6%8A%8AURL%E5%9C%B0%E5%9D%80%E4%B8%80%E5%B9%B6%E5%86%99%E5%85%A5%EF%BC%8C%E5%85%B6%E8%BF%94%E5%9B%9E%E6%A0%BC%E5%BC%8F%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%7B%22code%22%3A0%2C%22data%22%3A%7B%22username%22%3A%22%22%2C%22password%22%3A%22%22%2C%22hosts%22%3A%5B%228.142.177.235%3A2379%22%5D%7D%7D%0A2.%20ETCD%E9%87%8C%EF%BC%8C%E6%9C%89REDIS%20%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8F%90%E5%89%8D%E6%89%93%E5%85%A5%0Aetcdctl%20\-\-endpoints%3D127.0.0.1%3A2379%20put%20%20%2Fgamematch%2Fdev%2Fpid\_file\_path%20%2Ftmp%2Fgamematch.pid%0Aetcdctl%20\-\-endpoints%3D127.0.0.1%3A2379%20put%20%20%2Fgamematch%2Fdev%2Fredis\_host%20%208.142.177.235%0Aetcdctl%20\-\-endpoints%3D127.0.0.1%3A2379%20put%20%20%2Fgamematch%2Fdev%2Fredis\_port%206379%0Aetcdctl%20\-\-endpoints%3D8.142.177.235%3A2379%20put%20%20%2Fgamematch%2Fdev%2Fredis\_ps%201234%0Aetcdctl%20\-\-endpoints%3D127.0.0.1%3A2379%20put%20%20%2Fgamematch%2Fdev%2Freg\_self\_port%205678%0A3.%20ETCD%E9%87%8C%EF%BC%8C%E6%9C%89%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE%E5%A5%BD%E7%9A%84%E7%9A%84%EF%BC%9A%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8F%90%E5%89%8D%E6%89%93%E5%85%A5%0A%20%20%20%20etcdctl%20\-\-endpoints%3D8.142.177.235%3A2379%20put%20%2Fv1%2Fconf%2Fmatches%2Ftest\_match\_group%20'%7B%22id%22%3A6%2C%22games\_id%22%3A68043879%2C%22name%22%3A%221v1v1%22%2C%22status%22%3A1%2C%22match\_code%22%3A%22test\_match\_group%22%2C%22team\_type%22%3A1%2C%22max\_players%22%3A6%2C%22rule%22%3A%22%7B%7D%22%2C%22rule\_ver%22%3A1%2C%22timeout%22%3A10%2C%22success\_timeout%22%3A20%7D'%0A%20%0A%20%0A%20etcdctl%20\-\-endpoints%3D8.142.177.235%3A2379%20get%20%2F%20\-\-prefix%0A%20%0A%0A%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8Cetcd%EF%BC%8CKEY%EF%BC%9A%0A%2Fv1%2Fservice%2Fgamematch%2F192.168.1.169%3A6789%0A%0A%E8%B0%83%E7%94%A83%E6%96%B9%E6%9C%8D%E5%8A%A1etcd%2Ckey%3A%0A%2Fv1%2Fservice%2FmsgServer%2F192.168.1.169%3A8080%0A%20%0A%0A%0A%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0\-%E5%90%8E%E7%AB%AF%0A\-\-\-\-%0A%3Egit%20clone%20http%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2Fadminserver.git%0A%0A%E4%BE%9D%E8%B5%96%E7%BB%84%E4%BB%B6%EF%BC%9AETCD%20REDIS%20MYSQL%20EMAIL%20aliyun%0A%0A%E5%85%88%E5%AF%BC%E5%85%A5DB%EF%BC%8C%E4%B8%A4%E4%B8%AA%E5%BA%93%20pg\_account%20pg\_friend%0ACREATE%20DATABASE%20IF%20NOT%20EXISTS%20pg\_account%20DEFAULT%20CHARSET%20utf8%20COLLATE%20utf8\_general\_ci%3B%0Ause%20pg\_account%0Asource%20%2Finstall%2Fpg\_account.sql%0Asource%20%2Finstall%2Fpg\_account\_data.sql%0A%0A%E5%A4%84%E7%90%86%E4%B8%8B%E8%A7%86%E5%9B%BE%0A%60%60%60%0ASELECT%20TABLE\_SCHEMA%2C%20TABLE\_NAME%20FROM%20information\_schema.tables%20WHERE%20TABLE\_TYPE%20LIKE%20'VIEW'%3B%0Aauthority\_menu%3B%0ACREATE%20ALGORITHM%3DUNDEFINED%20DEFINER%3D%60root%60%40%60%25%60%20SQL%20SECURITY%20DEFINER%20VIEW%20%60authority\_menu%60%20%20AS%20SELECT%20%60sys\_base\_menus%60.%60id%60%20AS%20%60id%60%2C%20%60sys\_base\_menus%60.%60created\_at%60%20AS%20%60created\_at%60%2C%20%60sys\_base\_menus%60.%60updated\_at%60%20AS%20%60updated\_at%60%2C%20%60sys\_base\_menus%60.%60deleted\_at%60%20AS%20%60deleted\_at%60%2C%20%60sys\_base\_menus%60.%60menu\_level%60%20AS%20%60menu\_level%60%2C%20%60sys\_base\_menus%60.%60parent\_id%60%20AS%20%60parent\_id%60%2C%20%60sys\_base\_menus%60.%60path%60%20AS%20%60path%60%2C%20%60sys\_base\_menus%60.%60name%60%20AS%20%60name%60%2C%20%60sys\_base\_menus%60.%60hidden%60%20AS%20%60hidden%60%2C%20%60sys\_base\_menus%60.%60component%60%20AS%20%60component%60%2C%20%60sys\_base\_menus%60.%60title%60%20AS%20%60title%60%2C%20%60sys\_base\_menus%60.%60icon%60%20AS%20%60icon%60%2C%20%60sys\_base\_menus%60.%60sort%60%20AS%20%60sort%60%2C%20%60sys\_authority\_menus%60.%60sys\_authority\_authority\_id%60%20AS%20%60authority\_id%60%2C%20%60sys\_authority\_menus%60.%60sys\_base\_menu\_id%60%20AS%20%60menu\_id%60%2C%20%60sys\_base\_menus%60.%60keep\_alive%60%20AS%20%60keep\_alive%60%2C%20%60sys\_base\_menus%60.%60default\_menu%60%20AS%20%60default\_menu%60%20FROM%20\(%60sys\_authority\_menus%60%20join%20%60sys\_base\_menus%60%20on\(\(%60sys\_authority\_menus%60.%60sys\_base\_menu\_id%60%20%3D%20%60sys\_base\_menus%60.%60id%60\)\)\)%20%3B%0A%60%60%60%0A%0ACREATE%20DATABASE%20IF%20NOT%20EXISTS%20pg\_friend%20DEFAULT%20CHARSET%20utf8%20COLLATE%20utf8\_general\_ci%3B%0Ause%20pg\_friend%0Asource%20%2Finstall%2Fpg\_friend.sql%0A%60%60%60%0Acp%20config.toml.demo%20config.toml%0Avim%20config.toml%0A%60%60%60%0Ago%20run%20main.go%0A%0A%0A%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0\-%E5%89%8D%E7%AB%AF%0A\-\-\-\-%0A%3Egit%20clone%20http%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2Fadminweb.git%0A%0A%0Acentos%3Ayum%20install%20xdg\-utils%0A%0A%2F%2F%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85NODE%E4%BE%9D%E8%B5%96%E5%8C%85\(%E6%9C%80%E5%A5%BD%E6%98%AF%E6%8C%82VPN\)%0Anpm%20install%20\-\-unsafe\-perm%3Dtrue%20\-\-allow\-root%20%0A%0A%E5%90%AF%E5%8A%A8%0Anpm%20run%20serve%0A%0Ahttp%3A%2F%2F127.0.0.1%3A8080%0A%0A%E4%B8%8A%E9%9D%A2%E6%98%AF%E6%B5%8B%E8%AF%95%EF%BC%8C%E4%B8%8A%E5%88%B0%E6%AD%A3%E5%BC%8F%E7%8E%AF%E5%A2%83%EF%BC%8C%E6%98%AF%E5%B0%86%E5%89%8D%E7%AB%AFjs%E6%89%93%E5%8C%85%EF%BC%8C%E6%94%BE%E5%88%B0GO%E7%9A%84%E9%A1%B9%E7%9B%AE%E9%87%8C%EF%BC%8C%E7%BB%9F%E4%B8%80%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE%E5%B0%B1OK%E4%BA%86%0Anpm%20run%20build%0Acp%20\-r%20dist%20adminserver%2Fresource%0A%0Aaccount%0A\-\-\-\-%0A%3Egit%20clone%20http%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2Faccountserver.git%0Acp%20config.simple.toml%20config.toml%0A%0A~%2Fgo%2Fbin%2Fswag%20init%0A%0Ago%20run%20main.go%0A%0AmsgServer%0A\-\-\-\-%0A%3Egit%20clone%20http%3A%2F%2F192.168.1.22%3A40080%2Fservice%2Fpartygame%2FmsgServer.git%0Acp%20config.simple.toml%20config.toml%0A%20%0A%E4%BE%9D%E8%B5%96%20e%20%0A%0A%0A%E9%87%8D%E8%BF%9E%E6%A3%80%E6%B5%8B\-%E7%8E%A9%E5%AE%B6%E7%A6%BB%E7%BA%BF%E5%90%8E%E9%87%8D%E6%96%B0%E8%8E%B7%E5%8F%96%E7%BB%84%E9%98%9F%E4%BF%A1%E6%81%AF%E6%88%96%E9%87%8D%E6%96%B0%E8%BF%9B%E5%85%A5%E7%BB%84%E9%98%9F%0A%2Fbattle%2Fv1%2Fgroup%2Freconnect%2F63030530%0A%0A%E6%9F%A5%E8%AF%A2%E6%88%91%E6%89%80%E5%9C%A8%E7%9A%84%E6%9C%80%E6%96%B0%E9%98%9F%E4%BC%8D%E4%BF%A1%E6%81%AF%0AGET%20%2Fbattle%2Fv1%2Fgroup%2Finfo%2F63030530%20HTTP%2F1.1%20%0A
